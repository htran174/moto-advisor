{% extends "base.html" %}
{% block content %}
<section class="card" style="width:100%; max-width: 960px; overflow: hidden;">
  <!-- Header -->
  <div class="section-pad" style="background: linear-gradient(180deg, #F3F4F6, #FFFFFF); border-bottom:1px solid var(--border);">
    <h2 class="title" style="display:flex; align-items:center; gap:.75rem; flex-wrap:wrap;">
      <span>RideReady Advisor</span>
      <span class="subtitle" style="margin-left:auto;">No data saved • Local prototype</span>
    </h2>
  </div>

  <!-- Inputs -->
  <div class="section-pad" style="display:grid; gap:1rem;">
    <form id="inputsForm" style="display:grid; gap:1rem;">
      <div style="display:grid; gap:.5rem;">
        <label for="experience" style="font-weight:600;">Experience</label>
        <select id="experience" name="experience" style="padding:.7rem; border:1px solid var(--border); border-radius:10px;">
          <option value="new" selected>New rider</option>
          <option value="returning">Returning rider</option>
        </select>
      </div>

      <div style="display:grid; gap:.5rem;">
        <label for="height_cm" style="font-weight:600;">Height (cm)</label>
        <input id="height_cm" name="height_cm" type="number" min="140" max="210" value="170"
               style="padding:.7rem; border:1px solid var(--border); border-radius:10px;">
      </div>

      <div style="display:grid; gap:.5rem;">
        <label for="budget_usd" style="font-weight:600;">Budget (USD)</label>
        <input id="budget_usd" name="budget_usd" type="number" min="1000" max="20000" step="100" value="6000"
               style="padding:.7rem; border:1px solid var(--border); border-radius:10px;">
      </div>

      <div style="display:flex; align-items:center; gap:.5rem;">
        <input id="abs_toggle" type="checkbox" checked>
        <label for="abs_toggle">Require ABS</label>
      </div>

      <div style="display:grid; gap:.5rem;">
        <label for="k" style="font-weight:600;">How many results? (1–6)</label>
        <input id="k" name="k" type="number" min="1" max="6" value="3"
               style="padding:.7rem; border:1px solid var(--border); border-radius:10px;">
      </div>

      <div style="display:flex; gap:.75rem; align-items:center; flex-wrap:wrap;">
        <button id="btnGet" class="btn btn-primary" type="button">Get Recommendations</button>
        <a href="{{ url_for('disclaimer') }}" class="btn btn-outline" style="text-decoration:none;">View Disclaimer</a>
      </div>
      <p class="subtitle" style="margin: .25rem 0 0;">We’ll save your inputs locally and take you to the Recommendations page.</p>
    </form>
  </div>
</section>

<script>
(function(){
  const experience = document.getElementById('experience');
  const height_cm  = document.getElementById('height_cm');
  const budget_usd = document.getElementById('budget_usd');
  const abs_toggle = document.getElementById('abs_toggle');
  const kEl        = document.getElementById('k');
  const btnGet     = document.getElementById('btnGet');

  btnGet.addEventListener('click', () => {
    const profile = {
      experience: experience.value,
      height_cm: clamp(parseInt(height_cm.value || '170',10), 140, 210),
      budget_usd: clamp(parseInt(budget_usd.value || '6000',10), 1000, 20000),
      riding_style: [],
      must_have: abs_toggle.checked ? ['abs'] : [],
      k: clamp(parseInt(kEl.value || '3',10), 1, 6)
    };
    sessionStorage.setItem('rr.profile', JSON.stringify(profile));
    // Start a fresh recommendations history for this session if not present
    if(!sessionStorage.getItem('rr.history')){
      sessionStorage.setItem('rr.history', JSON.stringify([]));
    }
    window.location.href = "{{ url_for('recommendations') }}";
  });

  function clamp(n, min, max){ return Math.max(min, Math.min(max, n||min)); }
})();
</script>
{% endblock %}
