{% extends "base.html" %}
{% block content %}
  <section class="card" style="width:100%; max-width: 900px; overflow:hidden;">
    <!-- Chat header -->
    <div class="section-pad" style="background: linear-gradient(180deg, #F3F4F6, #FFFFFF); border-bottom: 1px solid var(--border);">
      <h2 class="title" style="display:flex; align-items:center; gap:.5rem;">
        <span class="title">RideReady Assistant</span>
        <span style="margin-left:auto; font-size:.95rem; color:var(--muted);">Weâ€™re online</span>
      </h2>
      <p class="subtitle">Ask anything about beginner bikes or gear. (Prototype â€” no data saved.)</p>
    </div>

    <!-- Chat body -->
    <div id="chatBody" style="padding: 1rem; height: 460px; overflow:auto; background: var(--surface-2);">
      <!-- Initial system message -->
      <div class="bubble bot">
        <p>Hello ðŸ‘‹ What would you like help with today?</p>
        <time></time>
      </div>
    </div>

    <!-- Composer -->
    <form id="chatForm" class="section-pad" style="display:flex; gap:.5rem; border-top:1px solid var(--border); background: var(--surface);">
      <label for="chatInput" class="sr-only">Enter your message</label>
      <input id="chatInput" name="message" type="text" autocomplete="off" placeholder="Enter your message..."
             style="flex:1; padding:.85rem 1rem; border:1px solid var(--border); border-radius: 999px; background:#fff;">
      <button class="btn btn-primary" type="submit" aria-label="Send message">Send</button>
    </form>
  </section>

  <style>
    .bubble{
      max-width: 76%;
      padding: .75rem 1rem;
      margin: .35rem 0;
      border-radius: 18px;
      line-height: 1.45;
      box-shadow: 0 2px 10px rgba(0,0,0,.05);
      word-wrap: break-word;
    }
    .bubble time{
      display:block;
      font-size: .75rem;
      color: var(--muted);
      margin-top: .35rem;
    }
    .bubble.user{
      margin-left: auto;
      background: linear-gradient(90deg, var(--primary), var(--primary-600));
      color: #fff;
      border-bottom-right-radius: 6px;
    }
    .bubble.bot{
      background: #ffffff;
      border: 1px solid var(--border);
      color: var(--text);
      border-bottom-left-radius: 6px;
    }
    .sr-only{
      position:absolute;
      width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>

  <script>
    (function(){
      const chatBody = document.getElementById('chatBody');
      const form = document.getElementById('chatForm');
      const input = document.getElementById('chatInput');

      function ts(){
        const d = new Date();
        return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      }

      function scrollToBottom(){
        chatBody.scrollTop = chatBody.scrollHeight;
      }

      function addBubble(text, who){
        const div = document.createElement('div');
        div.className = 'bubble ' + (who === 'user' ? 'user' : 'bot');
        div.innerHTML = `<p>${escapeHtml(text)}</p><time>${ts()}</time>`;
        chatBody.appendChild(div);
        scrollToBottom();
      }

      function escapeHtml(str){
        return str.replace(/[&<>"']/g, function(m){
          return ({
            '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
          })[m];
        });
      }

      form.addEventListener('submit', function(e){
        e.preventDefault();
        const text = (input.value || '').trim();
        if(!text) return;
        addBubble(text, 'user');
        input.value = '';

        // Prototype bot reply (pure frontend)
        setTimeout(function(){
          const reply = "Thanks! This is a prototype chat. Backend AI coming soon.";
          addBubble(reply, 'bot');
        }, 450);
      });
    })();
  </script>
{% endblock %}
