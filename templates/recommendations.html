{% extends "base.html" %}
{% set page_title = "Recommendations" %}

{% block content %}
<div class="card section-pad" id="pageRoot">
  <!-- Header row: title + tabs -->
  <div style="display:flex; align-items:center; justify-content:space-between; gap:.75rem; margin-bottom:.75rem;">
    <div>
      <h2 class="title" style="margin-bottom:.25rem;">Your Recommendations</h2>
      <div class="subtitle" id="loadingMsg">Loadingâ€¦</div>
    </div>

    <!-- Tabs -->
    <div role="tablist" aria-label="Recommendation & Chat" style="display:flex; gap:.5rem;">
      <button class="btn btn-primary" id="tabRecs" role="tab" aria-selected="true" aria-controls="panelRecs">Recommendations</button>
      <button class="btn btn-outline" id="tabChat" role="tab" aria-selected="false" aria-controls="panelChat">Chat</button>
    </div>
  </div>

  <!-- Actions row (right side) -->
  <div style="display:flex; align-items:center; gap:.5rem; margin-bottom:1rem; flex-wrap:wrap; justify-content:flex-end;">
    <a href="{{ url_for('advisor') }}" class="btn btn-outline" style="text-decoration:none;">Edit inputs</a>
    <button class="btn btn-primary" id="btnReRun" type="button">Re-run</button>
    <button class="btn btn-outline" id="btnClearHistory" type="button">Clear history</button>
  </div>

  <!-- Small meta line the JS updates (this was missing before) -->
  <div class="subtitle" id="meta" aria-live="polite"></div>

  <!-- Recommendations panel -->
  <section id="panelRecs" role="tabpanel" aria-labelledby="tabRecs" style="margin-top:.75rem;">
    <div id="cards" class="grid grid-2" style="min-height:140px;"></div>

    <details id="timelineWrap" style="margin-top:1rem;">
      <summary>Show full timeline snapshots</summary>
      <pre id="timeline" style="white-space:pre-wrap; font: 13px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:var(--surface-2); padding: .75rem; border-radius:10px; border:1px solid var(--border);"></pre>
    </details>
  </section>

  <!-- Chat panel -->
  <section id="panelChat" role="tabpanel" aria-labelledby="tabChat" hidden style="margin-top:.75rem;">
    <div class="card section-pad" style="background:var(--surface-2); border:1px dashed var(--border);">
      <div id="chatLog" style="min-height:120px;"></div>
      <div style="display:flex; gap:.5rem; margin-top:.75rem;">
        <input id="chatInput" type="text" placeholder="Type a message (e.g., /set k=3, then /rec)" style="flex:1; padding:.6rem .7rem; border-radius:10px; border:1px solid var(--border);" />
        <button id="chatSend" class="btn btn-primary" type="button">Send</button>
      </div>
    </div>
  </section>
</div>

<!-- Wire up the page JS -->
<script src="{{ url_for('static', filename='js/recommendations.js') }}"></script>
{% endblock %}
